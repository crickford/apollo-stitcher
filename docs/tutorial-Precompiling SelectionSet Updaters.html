<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: Precompiling SelectionSet Updaters</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: Precompiling SelectionSet Updaters</h1>

    <section>

<header>
    

    <h2>Precompiling SelectionSet Updaters</h2>
</header>

<article>
    <p>The selectionSet updater argument to the from and to methods can be used to modify an existing selection set using a pseudo-fragment named PreStitch by default. Under the hood, this is accomplished by converting the SDL string into a function that replaces the PreStitch fragment with the PreStitch selection set.</p>
<p>This means that on each request, a search is performed within the statically defined selection set for the pseudo-fragment, an operation which is in theory wasteful when done dynamically. The exported makeUpdater, makeTag, and stitch functions allow the static generation of this function, so that the precompiled function can be based as the selection set updater argument.</p>
<p>Note that the performance benefit of this approach is likely negligible, but that some may also prefer the static approach for code readability.</p>
<h3>Example Using stitch</h3><pre class="prettyprint source lang-javascript"><code>const { Stitcher, stitch } = require('apollo-stitcher');

// OLD: const toInsertUserSelectionSet = `{
// NEW:                  VVVV
const addInsertFields = stitch`{
  affected_rows
  returning {
    ...PreStitch
  }
}`;

class DbStitcher extends Stitcher {
  toInsertUser(args) {
    return this.to({
      operation: 'mutation',
      fieldName: 'insert_user',
      args: {
        objects: [args]
      },
      selectionSet: addInsertFields,
      extractor: result =>
        result && result.affected_rows ? result.returning[0] : null
    });
  }
}</code></pre><h3>Example Using makeTag</h3><pre class="prettyprint source lang-javascript"><code>const { Stitcher, makeTag } = require('apollo-stitcher');

// define the pseudo-fragment name
const myTag = makeTag('MyPseudoFragmentNamea');

// use the custom tag name instead of stitch
const addInsertFields = myTag`{
  affected_rows
  returning {
    ...MyPseudoFragmentName
  }
}`;

class DbStitcher extends Stitcher {
  toInsertUser(args) {
    return this.to({
      operation: 'mutation',
      fieldName: 'insert_user',
      args: {
        objects: [args]
      },
      selectionSet: addInsertFields,
      extractor: result =>
        result && result.affected_rows ? result.returning[0] : null
    });
  }
}</code></pre><h3>Example Using makeUpdater</h3><pre class="prettyprint source lang-javascript"><code>const { Stitcher, makeUpdater } = require('apollo-stitcher');

// use makeUpdater instead of makeTag if you prefer using a regular function
// instead of a tagged template literal. 
const addInsertFields = makeUpdater(`{
  affected_rows
  returning {
    ...MyPseudoFragmentName
  }
}`, 'MyPseudoFragmentName');

class DbStitcher extends Stitcher {
  toInsertUser(args) {
    return this.to({
      operation: 'mutation',
      fieldName: 'insert_user',
      args: {
        objects: [args]
      },
      selectionSet: addInsertFields,
      extractor: result =>
        result && result.affected_rows ? result.returning[0] : null
    });
  }
}</code></pre>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-apollo-stitcher.html">apollo-stitcher</a></li></ul><h3>Classes</h3><ul><li><a href="module-apollo-stitcher.ApolloClientLink.html">ApolloClientLink</a></li><li><a href="module-apollo-stitcher.Stitcher.html">Stitcher</a></li><li><a href="module-apollo-stitcher.StitchQuery.html">StitchQuery</a></li><li><a href="module-apollo-stitcher.TransformQuery.html">TransformQuery</a></li><li><a href="module-apollo-stitcher.UpdateSelectionSet.html">UpdateSelectionSet</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-Motivating Example.html">Motivating Example</a></li><li><a href="tutorial-Precompiling SelectionSet Updaters.html">Precompiling SelectionSet Updaters</a></li><li><a href="tutorial-Request Specific Caching.html">Request Specific Caching</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>